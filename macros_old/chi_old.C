string datadir = "../PbPb_2015/vnanal_2015/results/data/eta/";
string theorydir = "../PbPb_2015/vnanal_2015/results/theory/";
//string datadir = "SP_results/data/eta/";
//string theorydir = "SP_results/theory/";
TGraph * theory(string chi = "chi4", string calc="0.08 Tfo=150MeV", int color = kGreen);
int centbins[]{0,5,10,15,20,25,30,35,40,45,50,60,70};
TGraphErrors * getDist(string chiname="chi42", string side = "m", int minbin = 0, int maxbin = 11, int style=20, int color=kBlue);
void chi(){
  getDist();
  TCanvas * c = new TCanvas("c","c",1700,400);
  c->Divide(5);
  c->cd(1);
  TH1D * h422 = new TH1D("h","h",100,0,80);
  h422->SetMinimum(0);
  h422->SetMaximum(3);
  h422->GetXaxis()->SetTitleFont(43);
  h422->GetXaxis()->SetTitleSize(24);
  h422->GetYaxis()->SetTitleFont(43);
  h422->GetYaxis()->SetTitleSize(24);
  h422->GetXaxis()->SetLabelFont(43);
  h422->GetXaxis()->SetLabelSize(18);
  h422->GetYaxis()->SetLabelFont(43);
  h422->GetYaxis()->SetLabelSize(18);
  h422->GetYaxis()->SetTitleOffset(1.0);
  h422->SetXTitle("Centrality (\%)");
  h422->SetYTitle("#chi_{4}");
  h422->Draw();
  TGraphErrors * v422m = getDist("chi42","m",0,11,20,kRed);
  v422m->Draw("p");
  TGraphErrors * v422p = getDist("chi42","p",0,11,20,kBlue);
  v422p->Draw("p");
  TGraph * ghydro = theory("chi4","0.08 Tfo=150MeV",kGreen);
  TGraph * gAMPT = theory("chi4","AMPT",kCyan);
  ghydro->Draw("l");
  gAMPT->Draw("l");
  TLegend * leg = new TLegend(0.4,0.6,0.8,0.85);
  leg->SetFillColor(kWhite);
  leg->SetBorderSize(0);
  leg->SetTextFont(43);
  leg->SetTextSize(24);
  leg->AddEntry(v422m,"HF-","p");
  leg->AddEntry(v422p,"HF+","p");
  leg->AddEntry(ghydro,"hydro 0.08","l");
  leg->AddEntry(gAMPT,"AMPT","l");
  leg->Draw();
  c->cd(2);
  TH1D * h523 = new TH1D("h523","h",100,0,80);
  h523->SetMinimum(0);
  h523->SetMaximum(3);
  h523->GetXaxis()->SetTitleFont(43);
  h523->GetXaxis()->SetTitleSize(24);
  h523->GetYaxis()->SetTitleFont(43);
  h523->GetYaxis()->SetTitleSize(24);
  h523->SetXTitle("Centrality (\%)");
  h523->SetYTitle("#chi_{5}");
  h523->GetXaxis()->SetLabelFont(43);
  h523->GetXaxis()->SetLabelSize(18);
  h523->GetYaxis()->SetLabelFont(43);
  h523->GetYaxis()->SetLabelSize(18);
  h523->GetYaxis()->SetTitleOffset(1.0);
  h523->Draw();
  TGraphErrors * v523m = getDist("chi523A","m",0,11,20,kRed);
  TGraphErrors * v523p = getDist("chi523A","p",0,11,20,kBlue);
  v523m->Draw("p");
  v523p->Draw("p");
  theory("chi5","0.08 Tfo=150MeV",kGreen)->Draw("l");
  theory("chi5","AMPT",kCyan)->Draw("l");
  c->cd(3);
  TH1D * h6222 = new TH1D("h6222","h",100,0,80);
  h6222->SetMinimum(0);
  h6222->SetMaximum(3);
  h6222->GetXaxis()->SetTitleFont(43);
  h6222->GetXaxis()->SetTitleSize(24);
  h6222->GetYaxis()->SetTitleFont(43);
  h6222->GetYaxis()->SetTitleSize(24);
  h6222->SetXTitle("Centrality (\%)");
  h6222->SetYTitle("#chi_{62}");
  h6222->GetXaxis()->SetLabelFont(43);
  h6222->GetXaxis()->SetLabelSize(18);
  h6222->GetYaxis()->SetLabelFont(43);
  h6222->GetYaxis()->SetLabelSize(18);
  h6222->GetYaxis()->SetTitleOffset(1.0);
  h6222->Draw();
  TGraphErrors * v6222m = getDist("chi62","m",0,11,20,kRed);
  TGraphErrors * v6222p = getDist("chi62","p",0,11,20,kBlue);
  v6222m->Draw("p");
  v6222p->Draw("p");
  theory("chi62","0.08 Tfo=150MeV",kGreen)->Draw("l");
  theory("chi62","AMPT",kCyan)->Draw("l");
  c->cd(4);
  TH1D * h633 = new TH1D("h633","h",100,0,80);
  h633->SetMinimum(0);
  h633->SetMaximum(3);
  h633->GetXaxis()->SetTitleFont(43);
  h633->GetXaxis()->SetTitleSize(24);
  h633->GetYaxis()->SetTitleFont(43);
  h633->GetYaxis()->SetTitleSize(24);
  h633->SetXTitle("Centrality (\%)");
  h633->SetYTitle("#chi_{63}");
  h633->GetXaxis()->SetLabelFont(43);
  h633->GetXaxis()->SetLabelSize(18);
  h633->GetYaxis()->SetLabelFont(43);
  h633->GetYaxis()->SetLabelSize(18);
  h633->GetYaxis()->SetTitleOffset(1.0);
  h633->Draw();
  TGraphErrors * v633m = getDist("chi63","m",0,11,20,kRed);
  TGraphErrors * v633p = getDist("chi63","p",0,11,20,kBlue);
  v633m->Draw("p");
  v633p->Draw("p");
  theory("chi63","0.08 Tfo=150MeV",kGreen)->Draw("l");
  theory("chi63","AMPT",kCyan)->Draw("l");
  c->cd(5);
  TH1D * h723 = new TH1D("h","h",100,0,80);
  h723->SetMinimum(0);
  h723->SetMaximum(3);
  h723->GetXaxis()->SetTitleFont(43);
  h723->GetXaxis()->SetTitleSize(24);
  h723->GetYaxis()->SetTitleFont(43);
  h723->GetYaxis()->SetTitleSize(24);
  h723->SetXTitle("Centrality (\%)");
  h723->SetYTitle("#chi_{7}");
  h723->GetXaxis()->SetLabelFont(43);
  h723->GetXaxis()->SetLabelSize(18);
  h723->GetYaxis()->SetLabelFont(43);
  h723->GetYaxis()->SetLabelSize(18);
  h723->GetYaxis()->SetTitleOffset(1.0);
  h723->Draw();
  TGraphErrors * v723Am = getDist("chi723A","m",0,11,20,kRed);
  TGraphErrors * v723Ap = getDist("chi723A","p",0,11,20,kBlue);
  v723Am->Draw("p");
  v723Ap->Draw("p");
  theory("chi7","0.08 Tfo=150MeV",kGreen)->Draw("l");
  theory("chi7","AMPT",kCyan)->Draw("l");
  c->Print("resp.pdf","pdf");
  
}

TGraphErrors * getDist(string chiname, string side, int minbin, int maxbin, int style, int color){
  double x[12];
  double y[12];
  double ey[12];
  TGraphErrors * retg = new TGraphErrors(maxbin-minbin+1,x,y,0,ey); 
  int nbins = 0;
  for(int bin = minbin; bin<=maxbin; bin++){
    string fname = datadir+chiname+"SUB2_hf"+side+"_"+to_string(centbins[bin])+"-"+to_string(centbins[bin+1])+".dat";
    TGraphErrors * g = new TGraphErrors(fname.data(),"%lg %lg %lg");
    g->Fit("pol0","QR","",-2.4,2.4);
    retg->GetX()[nbins]=(centbins[bin+1]+centbins[bin])/2.;
    retg->GetY()[nbins]=g->GetFunction("pol0")->GetParameter(0);
    retg->GetEY()[nbins]=g->GetFunction("pol0")->GetParError(0);
    ++nbins;
  }
  retg->SetMarkerStyle(style);
  retg->SetMarkerColor(color);
  retg->SetLineColor(color);
  retg->SetName(chiname.data());
  return retg;
}

TGraph * theory(string chi, string calc, int color){
  string fname = theorydir+"CMS-"+chi+".dat";
  cout<<fname<<endl;
  FILE * fin=fopen(fname.data(),"r");
  char buf[100];
  double x[20];
  double y[20];
  int npnt = 0;
  while(fgets(buf,100,fin)!=NULL){
    std::string chk = buf;
    if(chk.find(calc)==std::string::npos) continue;
    fgets(buf,100,fin);
    bool getnext = true;
    while(getnext){
      string nchk = fgets(buf,100,fin);
      if(nchk.length()==1) {
	getnext=false;
	continue;
      }
      double fx,fy;
      sscanf(buf,"%lf %lf",&fx,&fy);
      x[npnt] = fx;
      y[npnt] = fy;
      ++npnt;
      sscanf(buf,"%lf %lf",&fx,&fy);
    }
    break;
  }
  TGraph *g = new TGraph(npnt,x,y);
  g->SetLineColor(color);
  g->SetLineWidth(2);
  g->SetName(chi.data());
  return g;
}
